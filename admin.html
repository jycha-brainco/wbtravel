<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>관리자 | 웰빙트래블 IR 사이트</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;900&display=swap" rel="stylesheet" />
  <style>
    /* ---- Admin Reset & Variables ---- */
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --admin-primary: #0066ff;
      --admin-primary-light: #e6f0ff;
      --admin-bg: #f5f6fa;
      --admin-sidebar: #0f1923;
      --admin-card: #ffffff;
      --admin-border: #e8eaed;
      --admin-text: #1a1a1a;
      --admin-text-secondary: #6b7280;
      --admin-danger: #ef4444;
      --admin-success: #22c55e;
      --admin-radius: 12px;
      --admin-shadow: 0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
      --admin-transition: 0.2s ease;
      --admin-font: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    html { font-size: 14px; }

    body {
      font-family: var(--admin-font);
      background: var(--admin-bg);
      color: var(--admin-text);
      line-height: 1.6;
      display: flex;
      min-height: 100vh;
    }

    a { text-decoration: none; color: inherit; }
    ul { list-style: none; }

    /* ---- Sidebar ---- */
    .sidebar {
      width: 240px;
      background: var(--admin-sidebar);
      color: #fff;
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      z-index: 100;
      transition: transform 0.3s ease;
    }

    .sidebar-header {
      padding: 24px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }

    .sidebar-logo {
      font-size: 1.2rem;
      font-weight: 900;
      letter-spacing: -0.02em;
    }

    .sidebar-logo .wb {
      background: linear-gradient(135deg, #0066ff, #00c6ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .sidebar-logo .travel {
      font-weight: 400;
      font-size: 0.95rem;
      opacity: 0.6;
    }

    .sidebar-badge {
      display: inline-block;
      margin-top: 4px;
      font-size: 0.65rem;
      font-weight: 600;
      padding: 2px 8px;
      border-radius: 10px;
      background: rgba(0,102,255,0.2);
      color: #60a5fa;
      letter-spacing: 0.05em;
    }

    .sidebar-nav {
      flex: 1;
      padding: 16px 12px;
    }

    .sidebar-nav-label {
      font-size: 0.7rem;
      font-weight: 600;
      color: rgba(255,255,255,0.3);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      padding: 8px 12px;
      margin-top: 8px;
    }

    .sidebar-nav a {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 500;
      color: rgba(255,255,255,0.5);
      transition: var(--admin-transition);
      margin-bottom: 2px;
    }

    .sidebar-nav a:hover {
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.8);
    }

    .sidebar-nav a.active {
      background: rgba(0,102,255,0.15);
      color: #60a5fa;
    }

    .sidebar-nav a svg {
      width: 18px;
      height: 18px;
      flex-shrink: 0;
    }

    .sidebar-footer {
      padding: 16px 20px;
      border-top: 1px solid rgba(255,255,255,0.06);
    }

    .sidebar-footer a {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.85rem;
      color: rgba(255,255,255,0.4);
      transition: var(--admin-transition);
    }

    .sidebar-footer a:hover { color: #fff; }
    .sidebar-footer svg { width: 16px; height: 16px; }

    /* ---- Main Content ---- */
    .main {
      margin-left: 240px;
      flex: 1;
      min-height: 100vh;
    }

    .topbar {
      background: var(--admin-card);
      border-bottom: 1px solid var(--admin-border);
      padding: 16px 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 50;
    }

    .topbar-title {
      font-size: 1.1rem;
      font-weight: 700;
      letter-spacing: -0.02em;
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .mobile-toggle {
      display: none;
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px;
    }

    .mobile-toggle svg {
      width: 24px;
      height: 24px;
      stroke: var(--admin-text);
    }

    .content {
      padding: 32px;
    }

    /* ---- Cards ---- */
    .card {
      background: var(--admin-card);
      border-radius: var(--admin-radius);
      border: 1px solid var(--admin-border);
      box-shadow: var(--admin-shadow);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      border-bottom: 1px solid var(--admin-border);
    }

    .card-header h2 {
      font-size: 1rem;
      font-weight: 700;
    }

    .card-body {
      padding: 24px;
    }

    /* ---- Stats ---- */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: var(--admin-card);
      border-radius: var(--admin-radius);
      padding: 24px;
      border: 1px solid var(--admin-border);
      box-shadow: var(--admin-shadow);
    }

    .stat-card-label {
      font-size: 0.8rem;
      color: var(--admin-text-secondary);
      font-weight: 500;
      margin-bottom: 8px;
    }

    .stat-card-value {
      font-size: 2rem;
      font-weight: 900;
      letter-spacing: -0.03em;
      background: linear-gradient(135deg, #0066ff, #00c6ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    /* ---- Buttons ---- */
    .btn-admin {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: var(--admin-transition);
      font-family: var(--admin-font);
    }

    .btn-admin svg { width: 16px; height: 16px; }

    .btn-admin-primary {
      background: var(--admin-primary);
      color: #fff;
    }
    .btn-admin-primary:hover { background: #0052cc; }

    .btn-admin-outline {
      background: transparent;
      color: var(--admin-text-secondary);
      border: 1px solid var(--admin-border);
    }
    .btn-admin-outline:hover {
      border-color: var(--admin-primary);
      color: var(--admin-primary);
    }

    .btn-admin-danger {
      background: transparent;
      color: var(--admin-danger);
      border: 1px solid #fecaca;
    }
    .btn-admin-danger:hover {
      background: #fef2f2;
    }

    .btn-admin-sm {
      padding: 5px 10px;
      font-size: 0.78rem;
    }

    /* ---- Table ---- */
    .table-container { overflow-x: auto; }

    table.admin-table {
      width: 100%;
      border-collapse: collapse;
    }

    .admin-table th {
      text-align: left;
      padding: 12px 16px;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--admin-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      border-bottom: 1px solid var(--admin-border);
      white-space: nowrap;
    }

    .admin-table td {
      padding: 14px 16px;
      font-size: 0.88rem;
      border-bottom: 1px solid var(--admin-border);
      vertical-align: top;
    }

    .admin-table tr:last-child td {
      border-bottom: none;
    }

    .admin-table tr:hover td {
      background: var(--admin-bg);
    }

    .actions-cell {
      display: flex;
      gap: 6px;
      white-space: nowrap;
    }

    .item-list {
      list-style: none;
      font-size: 0.82rem;
      color: var(--admin-text-secondary);
    }

    .item-list li { margin-bottom: 2px; }
    .item-list li::before {
      content: '- ';
      color: var(--admin-primary);
    }

    /* ---- Modal ---- */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      backdrop-filter: blur(4px);
      z-index: 200;
      align-items: center;
      justify-content: center;
    }

    .modal-overlay.open {
      display: flex;
    }

    .modal {
      background: var(--admin-card);
      border-radius: var(--admin-radius);
      width: 90%;
      max-width: 560px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.2);
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      border-bottom: 1px solid var(--admin-border);
    }

    .modal-header h3 {
      font-size: 1.05rem;
      font-weight: 700;
    }

    .modal-close {
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px;
      color: var(--admin-text-secondary);
      transition: var(--admin-transition);
    }

    .modal-close:hover { color: var(--admin-text); }
    .modal-close svg { width: 20px; height: 20px; }

    .modal-body {
      padding: 24px;
    }

    .modal-footer {
      padding: 16px 24px;
      border-top: 1px solid var(--admin-border);
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }

    /* ---- Form ---- */
    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      font-size: 0.82rem;
      font-weight: 600;
      color: var(--admin-text-secondary);
      margin-bottom: 6px;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid var(--admin-border);
      border-radius: 8px;
      font-size: 0.9rem;
      font-family: var(--admin-font);
      transition: var(--admin-transition);
      background: var(--admin-bg);
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--admin-primary);
      box-shadow: 0 0 0 3px rgba(0,102,255,0.1);
      background: #fff;
    }

    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }

    .form-hint {
      font-size: 0.75rem;
      color: var(--admin-text-secondary);
      margin-top: 4px;
    }

    /* ---- Pages visibility ---- */
    .page { display: none; }
    .page.active { display: block; }

    /* ---- Toast ---- */
    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: var(--admin-text);
      color: #fff;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 0.88rem;
      font-weight: 500;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      transform: translateY(100px);
      opacity: 0;
      transition: 0.3s ease;
      z-index: 300;
    }

    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    /* ---- Responsive ---- */
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .main {
        margin-left: 0;
      }

      .mobile-toggle {
        display: block;
      }

      .content {
        padding: 16px;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .topbar {
        padding: 12px 16px;
      }
    }
  </style>
</head>
<body>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-logo">
        <span class="wb">WB</span><span class="travel">TRAVEL</span>
      </div>
      <span class="sidebar-badge">ADMIN</span>
    </div>

    <nav class="sidebar-nav">
      <div class="sidebar-nav-label">관리</div>
      <a href="#" data-page="dashboard" class="active" onclick="showPage('dashboard', this)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M4 5a1 1 0 011-1h4a1 1 0 011 1v5a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM14 5a1 1 0 011-1h4a1 1 0 011 1v2a1 1 0 01-1 1h-4a1 1 0 01-1-1V5zM4 15a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1H5a1 1 0 01-1-1v-4zM14 12a1 1 0 011-1h4a1 1 0 011 1v7a1 1 0 01-1 1h-4a1 1 0 01-1-1v-7z"/></svg>
        대시보드
      </a>

      <div class="sidebar-nav-label">콘텐츠</div>
      <a href="#" data-page="history" onclick="showPage('history', this)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
        연혁 관리
      </a>
      <a href="#" data-page="portfolio" onclick="showPage('portfolio', this)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>
        포트폴리오 관리
      </a>
      <a href="#" data-page="clients" onclick="showPage('clients', this)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
        고객사 관리
      </a>
    </nav>

    <div class="sidebar-footer">
      <a href="/">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>
        IR 사이트 보기
      </a>
    </div>
  </aside>

  <!-- Main -->
  <div class="main">
    <div class="topbar">
      <div style="display:flex;align-items:center;gap:12px;">
        <button class="mobile-toggle" onclick="document.getElementById('sidebar').classList.toggle('open')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M4 6h16M4 12h16M4 18h16"/></svg>
        </button>
        <span class="topbar-title" id="pageTitle">대시보드</span>
      </div>
    </div>

    <div class="content">

      <!-- Dashboard -->
      <div class="page active" id="page-dashboard">
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-card-label">연혁 항목</div>
            <div class="stat-card-value" id="statHistory">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-label">포트폴리오</div>
            <div class="stat-card-value" id="statPortfolio">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-label">고객사</div>
            <div class="stat-card-value" id="statClients">0</div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>안내</h2>
          </div>
          <div class="card-body">
            <p style="color:var(--admin-text-secondary);font-size:0.9rem;line-height:1.8;">
              이 관리자 패널에서 IR 사이트의 <strong>연혁</strong>, <strong>포트폴리오</strong>, <strong>고객사</strong> 데이터를 관리할 수 있습니다.<br />
              변경 사항은 브라우저 로컬 스토리지에 저장되며, IR 사이트에 즉시 반영됩니다.<br /><br />
              <strong>구조 안내:</strong><br />
              - <strong>웰빙트래블 IR 사이트</strong> (index.html) : 기업 소개 및 IR 정보<br />
              - <strong>관리자 페이지</strong> (admin.html) : 연혁/포트폴리오/고객사 CRUD<br />
              - <strong>WBGolf 사이트</strong> (향후 구축) : 브루나이/말레이시아 미리 골프 전문 여행 페이지<br />
              - <strong>WBGolf 관리자</strong> (향후 구축) : 상품 구성 및 사이트 관리
            </p>
          </div>
        </div>
      </div>

      <!-- History Page -->
      <div class="page" id="page-history">
        <div class="card">
          <div class="card-header">
            <h2>연혁 관리</h2>
            <button class="btn-admin btn-admin-primary" onclick="openHistoryModal()">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 4v16m8-8H4"/></svg>
              추가
            </button>
          </div>
          <div class="card-body table-container">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>연도</th>
                  <th>내용</th>
                  <th style="width:120px;">작업</th>
                </tr>
              </thead>
              <tbody id="historyTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Portfolio Page -->
      <div class="page" id="page-portfolio">
        <div class="card">
          <div class="card-header">
            <h2>포트폴리오 관리</h2>
            <button class="btn-admin btn-admin-primary" onclick="openPortfolioModal()">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 4v16m8-8H4"/></svg>
              추가
            </button>
          </div>
          <div class="card-body table-container">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>프로젝트명</th>
                  <th>장소</th>
                  <th>인원</th>
                  <th>카테고리</th>
                  <th style="width:120px;">작업</th>
                </tr>
              </thead>
              <tbody id="portfolioTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Clients Page -->
      <div class="page" id="page-clients">
        <div class="card">
          <div class="card-header">
            <h2>고객사 관리</h2>
            <button class="btn-admin btn-admin-primary" onclick="openClientModal()">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 4v16m8-8H4"/></svg>
              추가
            </button>
          </div>
          <div class="card-body table-container">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>고객사명</th>
                  <th>카테고리</th>
                  <th style="width:120px;">작업</th>
                </tr>
              </thead>
              <tbody id="clientsTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Modal -->
  <div class="modal-overlay" id="modalOverlay" onclick="if(event.target===this)closeModal()">
    <div class="modal">
      <div class="modal-header">
        <h3 id="modalTitle">추가</h3>
        <button class="modal-close" onclick="closeModal()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="modal-body" id="modalBody"></div>
      <div class="modal-footer">
        <button class="btn-admin btn-admin-outline" onclick="closeModal()">취소</button>
        <button class="btn-admin btn-admin-primary" id="modalSaveBtn" onclick="saveModal()">저장</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <!-- Load shared data layer -->
  <script src="/main.js"></script>
  <script>
    // ---- Admin State ----
    let currentModal = null; // { type, mode, id }

    // ---- Page Navigation ----
    function showPage(page, el) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById('page-' + page).classList.add('active');

      document.querySelectorAll('.sidebar-nav a').forEach(a => a.classList.remove('active'));
      if (el) el.classList.add('active');

      const titles = { dashboard: '대시보드', history: '연혁 관리', portfolio: '포트폴리오 관리', clients: '고객사 관리' };
      document.getElementById('pageTitle').textContent = titles[page] || page;

      // Close mobile sidebar
      document.getElementById('sidebar').classList.remove('open');

      // Refresh data on page switch
      if (page === 'history') renderHistoryTable();
      if (page === 'portfolio') renderPortfolioTable();
      if (page === 'clients') renderClientsTable();
      if (page === 'dashboard') updateDashboardStats();
    }

    // ---- Dashboard ----
    function updateDashboardStats() {
      document.getElementById('statHistory').textContent = DataStore.getHistory().length;
      document.getElementById('statPortfolio').textContent = DataStore.getPortfolio().length;
      document.getElementById('statClients').textContent = DataStore.getClients().length;
    }

    // ---- HISTORY CRUD ----
    function renderHistoryTable() {
      const data = DataStore.getHistory();
      const tbody = document.getElementById('historyTableBody');
      tbody.innerHTML = data.map(item => `
        <tr>
          <td><strong>${item.year}</strong></td>
          <td>
            <ul class="item-list">
              ${item.items.map(i => `<li>${i}</li>`).join('')}
            </ul>
          </td>
          <td>
            <div class="actions-cell">
              <button class="btn-admin btn-admin-outline btn-admin-sm" onclick="editHistory(${item.id})">수정</button>
              <button class="btn-admin btn-admin-danger btn-admin-sm" onclick="deleteHistory(${item.id})">삭제</button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    function openHistoryModal(id) {
      const data = id ? DataStore.getHistory().find(h => h.id === id) : null;
      currentModal = { type: 'history', mode: data ? 'edit' : 'add', id: id || null };

      document.getElementById('modalTitle').textContent = data ? '연혁 수정' : '연혁 추가';
      document.getElementById('modalBody').innerHTML = `
        <div class="form-group">
          <label>연도</label>
          <input type="text" id="formYear" placeholder="예: 2024 또는 2020-2021" value="${data ? data.year : ''}" />
        </div>
        <div class="form-group">
          <label>내용</label>
          <textarea id="formItems" placeholder="한 줄에 하나씩 입력하세요">${data ? data.items.join('\n') : ''}</textarea>
          <div class="form-hint">각 항목을 줄바꿈으로 구분합니다.</div>
        </div>
      `;
      document.getElementById('modalOverlay').classList.add('open');
    }

    function editHistory(id) { openHistoryModal(id); }

    function deleteHistory(id) {
      if (!confirm('이 연혁 항목을 삭제하시겠습니까?')) return;
      const data = DataStore.getHistory().filter(h => h.id !== id);
      DataStore.setHistory(data);
      renderHistoryTable();
      showToast('연혁이 삭제되었습니다.');
    }

    // ---- PORTFOLIO CRUD ----
    function renderPortfolioTable() {
      const data = DataStore.getPortfolio();
      const tbody = document.getElementById('portfolioTableBody');
      const categoryLabels = { workshop: '워크샵', golf: '골프', event: '이벤트' };
      tbody.innerHTML = data.map(item => `
        <tr>
          <td><strong>${item.title}</strong></td>
          <td>${item.location}</td>
          <td>${item.participants}</td>
          <td>${categoryLabels[item.category] || item.category}</td>
          <td>
            <div class="actions-cell">
              <button class="btn-admin btn-admin-outline btn-admin-sm" onclick="editPortfolio(${item.id})">수정</button>
              <button class="btn-admin btn-admin-danger btn-admin-sm" onclick="deletePortfolio(${item.id})">삭제</button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    function openPortfolioModal(id) {
      const data = id ? DataStore.getPortfolio().find(p => p.id === id) : null;
      currentModal = { type: 'portfolio', mode: data ? 'edit' : 'add', id: id || null };

      document.getElementById('modalTitle').textContent = data ? '포트폴리오 수정' : '포트폴리오 추가';
      document.getElementById('modalBody').innerHTML = `
        <div class="form-group">
          <label>프로젝트명</label>
          <input type="text" id="formTitle" value="${data ? data.title : ''}" placeholder="예: A기업 워크샵" />
        </div>
        <div class="form-group">
          <label>장소</label>
          <input type="text" id="formLocation" value="${data ? data.location : ''}" placeholder="예: 방콕, 태국" />
        </div>
        <div class="form-group">
          <label>참가인원</label>
          <input type="text" id="formParticipants" value="${data ? data.participants : ''}" placeholder="예: 50명" />
        </div>
        <div class="form-group">
          <label>주요서비스</label>
          <input type="text" id="formServices" value="${data ? data.services : ''}" placeholder="예: 항공/숙박/차량/가이드 수배" />
        </div>
        <div class="form-group">
          <label>카테고리</label>
          <select id="formCategory">
            <option value="workshop" ${data && data.category === 'workshop' ? 'selected' : ''}>워크샵</option>
            <option value="golf" ${data && data.category === 'golf' ? 'selected' : ''}>골프</option>
            <option value="event" ${data && data.category === 'event' ? 'selected' : ''}>이벤트</option>
          </select>
        </div>
      `;
      document.getElementById('modalOverlay').classList.add('open');
    }

    function editPortfolio(id) { openPortfolioModal(id); }

    function deletePortfolio(id) {
      if (!confirm('이 포트폴리오를 삭제하시겠습니까?')) return;
      const data = DataStore.getPortfolio().filter(p => p.id !== id);
      DataStore.setPortfolio(data);
      renderPortfolioTable();
      showToast('포트폴리오가 삭제되었습니다.');
    }

    // ---- CLIENTS CRUD ----
    function renderClientsTable() {
      const data = DataStore.getClients();
      const tbody = document.getElementById('clientsTableBody');
      tbody.innerHTML = data.map(item => `
        <tr>
          <td><strong>${item.name}</strong></td>
          <td>${item.category}</td>
          <td>
            <div class="actions-cell">
              <button class="btn-admin btn-admin-outline btn-admin-sm" onclick="editClient(${item.id})">수정</button>
              <button class="btn-admin btn-admin-danger btn-admin-sm" onclick="deleteClient(${item.id})">삭제</button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    function openClientModal(id) {
      const data = id ? DataStore.getClients().find(c => c.id === id) : null;
      currentModal = { type: 'clients', mode: data ? 'edit' : 'add', id: id || null };

      document.getElementById('modalTitle').textContent = data ? '고객사 수정' : '고객사 추가';
      document.getElementById('modalBody').innerHTML = `
        <div class="form-group">
          <label>고객사명</label>
          <input type="text" id="formClientName" value="${data ? data.name : ''}" placeholder="예: 삼성전자" />
        </div>
        <div class="form-group">
          <label>카테고리</label>
          <select id="formClientCategory">
            <option value="대기업" ${data && data.category === '대기업' ? 'selected' : ''}>대기업</option>
            <option value="금융" ${data && data.category === '금융' ? 'selected' : ''}>금융</option>
            <option value="공공기관" ${data && data.category === '공공기관' ? 'selected' : ''}>공공기관</option>
            <option value="교육" ${data && data.category === '교육' ? 'selected' : ''}>교육</option>
            <option value="기업" ${data && data.category === '기업' ? 'selected' : ''}>기업</option>
            <option value="미디어" ${data && data.category === '미디어' ? 'selected' : ''}>미디어</option>
            <option value="여행" ${data && data.category === '여행' ? 'selected' : ''}>여행</option>
            <option value="유통" ${data && data.category === '유통' ? 'selected' : ''}>유통</option>
            <option value="협회" ${data && data.category === '협회' ? 'selected' : ''}>협회</option>
          </select>
        </div>
      `;
      document.getElementById('modalOverlay').classList.add('open');
    }

    function editClient(id) { openClientModal(id); }

    function deleteClient(id) {
      if (!confirm('이 고객사를 삭제하시겠습니까?')) return;
      const data = DataStore.getClients().filter(c => c.id !== id);
      DataStore.setClients(data);
      renderClientsTable();
      showToast('고객사가 삭제되었습니다.');
    }

    // ---- MODAL SAVE ----
    function saveModal() {
      if (!currentModal) return;

      if (currentModal.type === 'history') {
        const year = document.getElementById('formYear').value.trim();
        const items = document.getElementById('formItems').value.trim().split('\n').filter(i => i.trim());
        if (!year || !items.length) { showToast('모든 필드를 입력해주세요.'); return; }

        const data = DataStore.getHistory();
        if (currentModal.mode === 'edit') {
          const idx = data.findIndex(h => h.id === currentModal.id);
          if (idx >= 0) { data[idx].year = year; data[idx].items = items; }
        } else {
          const maxId = data.reduce((max, h) => Math.max(max, h.id), 0);
          data.push({ id: maxId + 1, year, items });
        }
        DataStore.setHistory(data);
        renderHistoryTable();

      } else if (currentModal.type === 'portfolio') {
        const title = document.getElementById('formTitle').value.trim();
        const location = document.getElementById('formLocation').value.trim();
        const participants = document.getElementById('formParticipants').value.trim();
        const services = document.getElementById('formServices').value.trim();
        const category = document.getElementById('formCategory').value;
        if (!title || !location) { showToast('필수 필드를 입력해주세요.'); return; }

        const data = DataStore.getPortfolio();
        if (currentModal.mode === 'edit') {
          const idx = data.findIndex(p => p.id === currentModal.id);
          if (idx >= 0) { Object.assign(data[idx], { title, location, participants, services, category }); }
        } else {
          const maxId = data.reduce((max, p) => Math.max(max, p.id), 0);
          data.push({ id: maxId + 1, title, location, participants, services, category });
        }
        DataStore.setPortfolio(data);
        renderPortfolioTable();

      } else if (currentModal.type === 'clients') {
        const name = document.getElementById('formClientName').value.trim();
        const category = document.getElementById('formClientCategory').value;
        if (!name) { showToast('고객사명을 입력해주세요.'); return; }

        const data = DataStore.getClients();
        if (currentModal.mode === 'edit') {
          const idx = data.findIndex(c => c.id === currentModal.id);
          if (idx >= 0) { data[idx].name = name; data[idx].category = category; }
        } else {
          const maxId = data.reduce((max, c) => Math.max(max, c.id), 0);
          data.push({ id: maxId + 1, name, category });
        }
        DataStore.setClients(data);
        renderClientsTable();
      }

      closeModal();
      showToast('저장되었습니다.');
    }

    // ---- MODAL CONTROLS ----
    function closeModal() {
      document.getElementById('modalOverlay').classList.remove('open');
      currentModal = null;
    }

    // ---- TOAST ----
    function showToast(msg) {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2500);
    }

    // ---- INIT ----
    document.addEventListener('DOMContentLoaded', () => {
      updateDashboardStats();
      renderHistoryTable();
      renderPortfolioTable();
      renderClientsTable();
    });
  </script>
</body>
</html>
